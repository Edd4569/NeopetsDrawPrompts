<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Neopets Goodies!</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrap">
    <h1>Neopets Goodie<span id="secretS">s</span>!</h1>
    <div class="panel">
    <div class="buttons" style="justify-content: center;">
        <button id="btnRandom">Random P2</button>
        <button id="btnReal">Real P2</button>
        <button id="btnFake">Non-Existent P2</button>
        <button id="btnPPLR">Petpet Lab Ray</button>
        <button id="btnDAM">#data-and-mechanics</button>
    </div>
    <div id="intro" class="meta "></div>
    <div id="divMain" class="hidden">
        <div id="output" class="result">Click a button</div>
        <div id="outputMeta" class="meta"></div>
    </div>
    <div id="divFunc4" class="hidden">
        <div id="labRayOutput">labRay</div>
        <div id="abc" class="collected">
          <div class="card">
            <div class="center">
              <h2>Collected Petpets!</h2>
              <div class="subtitle">Can you collect them all!</div>
              <div id="grid" class="grid-container"></div>
            </div>
          </div>
        </div>
    </div>
    </div>
  </div>
<footer class="site-footer">
  <div class="site-footer__inner">
    <p class="site-footer__text">
      Â© 1999-2025 Neopets, Inc. All rights reserved.<br>
      Unofficially powered by the
      <a href="https://items.jellyneo.net/" target="_blank" rel="noopener noreferrer">
        Jellyneo Item Database</a>.
    </p>

    <div class="site-footer__fineprint">
      <div>This is an unauthorized fan site (v12.26.2025)</div>
      <div>Questions? Concerns? Ideas? DM @eddwith3ds on discord</div>
    </div>
  </div>
</footer>

  <script>
    const $ = (id) => document.getElementById(id);

    function randInt(minInclusive, maxInclusive) {
      return Math.floor(Math.random() * (maxInclusive - minInclusive + 1)) + minInclusive;
    }

    function randChoice(arr) {
      return arr[randInt(0, arr.length - 1)];
    }

    function colorNameFromId(colorId) {
        if (!Number.isInteger(colorId)) {
            return "(invalid colorId)";
        }
        if (colorId < 0 || colorId >= p2Colors.length) {
            return `(unknown colorId ${colorId})`;
        }
        return p2Colors[colorId];
    }

    function showMain() {
      $("divMain").classList.remove("hidden");
      $("divFunc4").classList.add("hidden");
    }

    function showPPLR() {
      $("divMain").classList.add("hidden");
      $("divFunc4").classList.remove("hidden");
      setOutput(``,``);
    }

    function setOutput(titleText, metaText = "") {
      $("output").innerHTML = titleText;
      $("intro").innerHTML = metaText + `<br>`;
    }
    function setLabOutput(titleText, metaText = "") {
        $("labRayOutput").innerHTML = titleText;
    }

    function ensureDataReady() {
      if (!Array.isArray(p2Colors) || p2Colors.length === 0) {
        return false;
      }
      if (!Array.isArray(p2Types) || p2Types.length === 0) {
        return false;
      }
      if (!Array.isArray(fullArray) || fullArray.length === 0) {
        return true;
      }
      if (!Array.isArray(SillyP2Colors) || SillyP2Colors.length === 0) {
        return true;
      }
      return true;
    }

    function runFunction1() {
      showMain();
      if (!ensureDataReady()) {
        return;
      }

      const type = randChoice(p2Types);
      const color = randChoice(p2Colors);

      setOutput(jnLinkFormat(color,type,0),`- Generate a real or fake Petpet Color/Species`);
    }

    function runFunction2() {
      showMain();
      if (!ensureDataReady()) {
        return;
      }

      if (!Array.isArray(fullArray) || fullArray.length === 0) {
        return;
      }

      const entry = randChoice(fullArray);
      if (!entry || typeof entry.t !== "string" || !Array.isArray(entry.v) || entry.v.length === 0) {
        return;
      }

      const colorId = randChoice(entry.v);
      const colorName = colorNameFromId(colorId);
      setOutput(jnLinkFormat(colorName,entry.t,1),`- Generate a real Petpet Color/Species`);
    }

    function runFunction3() {
      showMain();
      if (!ensureDataReady()) {
        return;
      }

      if (!Array.isArray(fullArray) || fullArray.length === 0) {
        return;
      }

      const entry = randChoice(fullArray);
      if (!entry || typeof entry.t !== "string" || !Array.isArray(entry.v)) {
        return;
      }

      const allColors = Array.from({ length: p2Colors.length }, (_, id) => id);
      const validSet = new Set(entry.v.filter(Number.isInteger));
      const b = Number.isInteger(entry.b) ? entry.b : null;
      const inv = allColors.filter(id => !validSet.has(id) && (b === null || id !== b));

      if (inv.length === 0) {
        setOutput(`${entry.t}`, `No invalid colors available`);
        return;
      }

      const colorId = randChoice(inv);
      const colorName = colorNameFromId(colorId);

      setOutput(jnLinkFormat(colorName,entry.t,0),`- Should generate a Petpet Color/Species combo that doesn't exist on site. (Unless TNT releases a new combo before I can update)`);
    }

    function runFunction5()  {
      showMain();
      if (!ensureDataReady()) {
        return;
      }
      const type = randChoice(p2Types);
      const color = randChoice(SillyP2Colors);

      setOutput(jnLinkFormat(color,type,0),`- Generate a secret fake Petpet Color/Species`);
    }

    function getDrawText(item) {
        let print = 'You should draw a';
        if (item.charAt(0) == 'A' ||item.charAt(0) == 'E'|| item.charAt(0) == 'I'|| item.charAt(0) == 'O') {
            print += 'n';
        }
        print += ":<br> " +item + "! ";
        return print;
    }

    function jnLinkFormat(color, type, real) {
        let textPrompt = getDrawText(`${color} ${type}`);
        let url = "https://items.jellyneo.net/search/all-petpets/?name=%s";
        let url2 =  "https://items.jellyneo.net/search/all-petpets/?name=%s&name_type=3";
        let image = "https://images.neopets.com/items/toy_plushie_negg_fish.gif";
        url = url.replace("%s", type);
        if (real==1) {
            url2 = url2.replace("%s", "" +color +" "+type);
            return `<div>${textPrompt}<br><a tabindex='-1' target='_blank' href='${url2}'><img src='${image}' class='searchImg'></a></div>`;
        } else {
            url = url.replace("%s", type);
            return `<div>${textPrompt}<br><a tabindex='-1' target='_blank' href='${url}'><img src='${image}' class='searchImg'></a></div>`;
        }
    }

    $("btnRandom").addEventListener("click", runFunction1);
    $("btnReal").addEventListener("click", runFunction2);
    $("btnFake").addEventListener("click", runFunction3);

    $("btnPPLR").addEventListener("click", () => {
      showPPLR();
      p2labRay();
    });

    $("btnDAM").addEventListener("click", () => {
      window.open("https://edd4569.github.io/Mystery-Solving/", "_blank", "noopener,noreferrer");
    });

  </script>
  <script src="./script.js"></script>
  <script src="./p2zone.js"></script>
  <script src="./labRayScript.js"></script>
</body>
</html>
